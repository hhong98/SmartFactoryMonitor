<UserControl
    x:Class="SmartFactoryMonitor.Controls.OptionComboBox"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:SmartFactoryMonitor.Controls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    x:Name="Root"
    mc:Ignorable="d">

    <Grid>
        <ToggleButton x:Name="FilterToggle" Cursor="Hand">
            <ToggleButton.Content>
                <StackPanel
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Orientation="Horizontal">

                    <TextBlock x:Name="SelectedDisplay" FontSize="{Binding DisplaySize, ElementName=Root}">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Text" Value="{Binding SelectedOption, ElementName=Root}" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding SelectedOption, ElementName=Root}" Value="{x:Null}">
                                        <Setter Property="Text" Value="{Binding Placeholder, ElementName=Root}" />
                                        <Setter Property="Foreground" Value="Black" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                    <TextBlock FontSize="{Binding DisplaySize, ElementName=Root}" Text=" ▼" />
                </StackPanel>
            </ToggleButton.Content>
            <ToggleButton.Style>
                <Style TargetType="ToggleButton">
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="ToggleButton">
                                <Border
                                    Background="{StaticResource MainBackgroundBrush}"
                                    BorderBrush="#C7CCD1"
                                    BorderThickness="1"
                                    CornerRadius="5">
                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                                </Border>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </ToggleButton.Style>
        </ToggleButton>

        <Popup
            Width="{Binding ActualWidth, ElementName=FilterToggle}"
            AllowsTransparency="True"
            IsOpen="{Binding IsChecked, ElementName=FilterToggle}"
            Placement="Bottom"
            PlacementTarget="{Binding ElementName=FilterToggle}"
            PopupAnimation="None"
            StaysOpen="False">
            <Border
                Padding="5"
                Background="{StaticResource BorderBrush}"
                CornerRadius="5">
                <ItemsControl ItemsSource="{Binding ItemsSource, ElementName=Root}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Button
                                Padding="10,5"
                                Background="{StaticResource MainBackgroundBrush}"
                                BorderThickness="0"
                                Click="OnOptionClick"
                                Content="{Binding}"
                                FontSize="{Binding OptionSize, ElementName=Root}"
                                FontWeight="Medium" />
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </Border>
        </Popup>
    </Grid>
</UserControl>